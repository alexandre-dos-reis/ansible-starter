# https://taskfile.dev

version: '3'

silent: true

includes:

  conductor:
    taskfile: ./vagrant/vagrant-taskfile.yaml
    vars:
      WORKING_DIR: ./vagrant/conductor
      REMOVE_KEYS: false

  nodes:
    taskfile: ./vagrant/vagrant-taskfile.yaml
    vars:
      WORKING_DIR: vagrant/nodes
      REMOVE_KEYS: true


tasks:

  default:
    cmds:
      - task --list

  install:
    desc: Install all the dependencies needed for running the project.
    cmds:
      - vagrant plugin install vagrant-list  # https://github.com/joshmcarthur/vagrant-list

  list:
    desc: List all the VMs initialized by Vagrant.
    cmds:
      - vagrant list

  up:
    desc: Start the conductor and nodes VMs.
    deps: [nodes:up, conductor:up]

  provision:
    desc: Provision the conductor and nodes VMs.
    deps: [nodes:provision, conductor:provision]

  destroy:
    desc: Destroy all the VMs and remove files generated by Vagrant.
    deps: [nodes:destroy, conductor:destroy]

  cleanup:
    deps: [destroy]
    desc: Destroy all the VMs and remove files generated by Vagrant.
    cmds:
      - rm -Rf ./vagrant/conductor/.vagrant
      - rm -Rf ./vagrant/nodes/.vagrant
      - echo ''
      - echo '### Cleanup done !'